<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; connect-src 'self' http://localhost:* https://localhost:* ws://localhost:* wss://localhost:* https://tavusapi.com https://cdn.jsdelivr.net https://huggingface.co https://*.hf.co https://*.xethub.hf.co https://cas-bridge.xethub.hf.co; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net; frame-src 'self' https://tavus.daily.co;">
    <link rel="stylesheet" href="css/style.css">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1/dist/transformers.min.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            checkAuth();
        });
    </script>
</head>
<body>
    <div class="index-main-content">
        <header>
            <h6 id="myName">Business Boom</h1>
            <div class="logo">
                <a href="https://bolt.new/"><img src="images/bolt.png" width="75px" height="75px" alt="Site Logo"/></a>
            </div>
            <nav class="menu">
                <ul class="menuItems">
                    <li><a class='btn' href="index.html">Home</a></li>
                    <li><a class='btn' href="#" onclick="navigateTo('dashboard')">Businesses</a></li>
                    <li><a class='btn' href="#" onclick="navigateTo('analysis')">Planning</a></li>
                    <li><a class='btn' href="#" onclick="navigateTo('conversation')">Ai</a></li>
                    <li><a class='btn' href="#" onclick="logout()">Logout</a></li>
                </ul>
            </nav>
        </header>

        <button id="select-past-business" class="secondary">Select Past Business</button>

        <div class="main-content">
            <div id="analysis-content">
                <h3>SWOT Analysis</h3>
            </div>
        </div>


        <div class="analysis-btns">
            <button class="analysis"><a href="#" onclick="navigateTo('conversation')">Start new analysis</a></button>
            <button class="analysis"><a href="#" onclick="navigateTo('conversation')">Continue Current Analysis</a></button>
        </div>

        <footer>
            <div class="myfoot">
            <p>Â© 2025 Business Is Boomin</p>
            <a href="about.html">About us</a>
            </div>
        </footer>
    </div>
    <script src="js/app.js"></script>
    <script src="js/conversation.js"></script>
    <script src="js\analysis-display.js"></script>
    <script>
        async function loadBusinessAnalysis() {
            try {
                console.log('Loading business analysis...');
                console.log('Current business:', window.currentBusiness);
                
                if (!window.currentBusiness?.id) {
                    document.querySelector('.main-content').innerHTML = 
                        '<p>No business selected. <a href="dashboard.html">Go to dashboard</a></p>';
                    return;
                }
                
                try {
                    const analysis = await window.getBusinessAnalysis(window.currentBusiness.id);
                    displayAnalysis(analysis);
                } catch (error) {
                    console.log('No existing analysis, showing generate option');
                    showGenerateAnalysisOption();
                }
                
            } catch (error) {
                console.error('Error loading analysis:', error);
                document.querySelector('.main-content').innerHTML = 
                    '<p>Error loading analysis. Please try again.</p>';
            }
        }

        function showGenerateAnalysisOption() {
            document.querySelector('.main-content').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h2>No Analysis Available</h2>
                    <p>Generate a comprehensive business analysis based on your conversations.</p>
                    <button id="generate-analysis-btn" class="btn">Generate Analysis</button>
                </div>
            `;
            
            document.getElementById('generate-analysis-btn').addEventListener('click', async function() {
                this.disabled = true;
                this.textContent = 'Generating...';
                
                try {
                    const analysis = await window.generateBusinessAnalysis(window.currentBusiness.id);
                    displayAnalysis(analysis);
                } catch (error) {
                    alert('Failed to generate analysis: ' + error.message);
                    this.disabled = false;
                    this.textContent = 'Generate Analysis';
                }
            });
        }

        function displayAnalysis(analysis) {
            window.NewAnalysisDisplay.render(analysis, 'analysis-content');
        }

        function showGenerateAnalysisOption() {
            document.getElementById('analysis-content').innerHTML = window.NewAnalysisDisplay.renderGenerateOption();
            
            document.getElementById('generate-analysis-btn').addEventListener('click', async function() {
                this.disabled = true;
                this.textContent = 'Generating...';
                
                try {
                    const analysis = await window.generateBusinessAnalysis(window.currentBusiness.id);
                    displayAnalysis(analysis);
                } catch (error) {
                    alert('Failed to generate analysis: ' + error.message);
                    this.disabled = false;
                    this.textContent = 'Generate Analysis';
                }
            });
        }

        // Load analysis when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(loadBusinessAnalysis, 1000); // Wait for other scripts to load
        });
    </script>
</body>
</html>